# Maintainer: Ari Mizrahi <codemunchies@gmail.com>

pkgname=artillery
pkgver=git
pkgrel=2
pkgdesc="a combination of a honeypot, file-system monitoring, system hardening, and overall health of a server to create a comprehensive way to secure a system"
arch=('i686' 'x86_64')
url=('https://www.trustedsec.com/downloads/artillery/')
license=('BSD 3 clause')
depends=('python2')
makedepends=('git')
source=('git+https://github.com/trustedsec/artillery/')
md5sums=('SKIP')

prepare() {
  cd "$srcdir/artillery"

  sed -i "s|/var|$pkgdir/var|g" setup.py
  sed -i "s|/etc|$pkgdir/etc|g" setup.py
}

package() {
  cd "$srcdir/artillery"

  python2 setup.py <<< $'y\nn\nn'

  rm "$pkgdir/var/artillery/setup.py"

  install -dm755 "$pkgdir/usr/bin"
  cat > "$pkgdir/usr/bin/artillery" <<EOF
#!/bin/sh
cd /var/artillery
if test \$EUID != 0 ; then
  echo 'Must be run as root.'
  exit 1
fi
python2 artillery.py "\$@"
EOF
  chmod +x "$pkgdir/usr/bin/artillery"
}
